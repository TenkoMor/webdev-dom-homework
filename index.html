<!DOCTYPE html>
<html>

<head>
  <title>Проект "Комменты"</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="container">
    <ul class="comments" id="list">
    </ul>
    <div class="add-form">
      <input type="text" class="add-form-name" placeholder="Введите ваше имя" id="name-input" />
      <textarea type="textarea" class="add-form-text" placeholder="Введите ваш коментарий" rows="4"
        id="comment-input"></textarea>
      <div class="add-form-row">
        <button class="button" id="add-button">Написать</button>
      </div>
    </div>
    <button class="button" id="delete-button">Удалить последний комментарий</button>
  </div>
</body>

<script>
  "use strict";
  const buttonElement = document.getElementById("add-button");
  const listElement = document.getElementById("list");
  const nameInputElement = document.getElementById("name-input");
  const commentInputElement = document.getElementById("comment-input");
  const delButtonElement = document.getElementById("delete-button");

  const postingDate = () => {
    const date = new Date();
    return `${Intl.DateTimeFormat('ru-RU', { day: 'numeric', month: 'numeric', year: '2-digit' }).format(date)} ${Intl.DateTimeFormat('ru-RU', { timeStyle: 'short' }).format(date)}`;
  };

  const comments = [
    {
      name: 'Глеб Фокин',
      date: '12.02.22 12:18',
      comment: 'Это будет первый комментарий на этой странице',
      likes: 3,
      like: false,
      isEdit: false
    },
    {
      name: 'Варвара Н.',
      date: '13.02.22 19:22',
      comment: 'Мне нравится как оформлена эта страница! ❤',
      likes: 75,
      like: false,
      isEdit: false
    }
  ];

  const likeButtonWork = () => {
    const likeButtonsElements = document.querySelectorAll(".like-button");

    for (const likeButtonElement of likeButtonsElements) {
      likeButtonElement.addEventListener("click", () => {
        const index = likeButtonElement.dataset.index;
        const comm = comments[index];
        
        if (comm.like === false) {
          comm.like = true;
          comm.likes += 1;
          comm.isActive = '-active-like';
        } else if (comm.like === true) {
          comm.like = false;
          comm.likes -= 1;
          delete comm.isActive;
        };

        renderComments();
      });
    };
  };

  const showTextArea = (index) => {
    const commentsBodyElements = document.querySelectorAll(".comment-body");

    for (const commentBodyElement of commentsBodyElements){
      if (commentBodyElement.dataset.index === index){
        commentBodyElement.innerHTML = `<textarea type="textarea" class="add-form-text edit-form-text" id="edit-comment" placeholder="Введите ваш коментарий" rows='4'>${comments[index].comment}</textarea>`;
      };
    };
  };
  const hideTextArea = (index) => {
    const commentsBodyElements = document.querySelectorAll(".comment-body");

    for (const commentBodyElement of commentsBodyElements){
      if (commentBodyElement.dataset.index === index){
        commentBodyElement.innerHTML = `<div class="comment-text">${user.comment}</div>`;
      };
    };
  };
  const editComment = () => {
    const editButtonsElements = document.querySelectorAll(".edit-button");

    for (const editButtonElement of editButtonsElements){
      editButtonElement.addEventListener("click", () => {
        const index = editButtonElement.dataset.index;
        const comm = comments[index];

        if (comm.isEdit === false){
          comm.isEdit = true;
          showTextArea(index);
          editButtonElement.innerHTML = 'Сохранить';
          return
        } else if (comm.isEdit === true){
          comm.isEdit = false;
          comm.comment = document.getElementById("edit-comment").value;
        }
        renderComments();
      });
    };
  };

  const renderComments = () => {
    const commentsHtml = comments.map((user, index) => {
      return `<li class="comment">
          <div class="comment-header">
            <div>${user.name}</div>
            <div>${user.date}</div>
          </div>
          <div class="comment-body" data-index="${index}">
            <div class="comment-text">${user.comment}</div>
          </div>
          <div class="comment-footer">
            <button class="button edit-button" data-index="${index}">Редактировать</button>
            <div class="likes">
              <span class="likes-counter">${user.likes}</span>
              <button class="like-button ${user.isActive}" data-index="${index}"></button>
            </div>
          </div>
        </li>`;
    }).join('');

    listElement.innerHTML = commentsHtml;

    likeButtonWork();
    editComment();
  };

  renderComments();

  buttonElement.disabled = true;

  addEventListener("input", (event) => {
    if (nameInputElement.value == "" || commentInputElement.value == "") {
      buttonElement.disabled = true;
    };
    if (nameInputElement.value != "" && commentInputElement.value != "") {
      buttonElement.disabled = false;
    };
  });

  buttonElement.addEventListener("click", () => {
    comments.push({
      name: nameInputElement.value,
      date: postingDate(),
      comment: commentInputElement.value,
      likes: 0,
      like: false,
      isEdit: false
    })

    renderComments();

    nameInputElement.value = "";
    commentInputElement.value = "";
    buttonElement.disabled = true;
  });

  delButtonElement.addEventListener("click", () => {
    comments.pop();
    renderComments();
  });

  console.log("It works!");
</script>

</html>